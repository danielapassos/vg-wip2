import{S as me,i as ve,s as pe,k as y,a as P,q,l as w,m as I,h as C,c as V,r as F,J as ae,n as p,b as ge,G as h,u as ie,H as le,y as J,z as U,A as X,K as he,L as oe,M as Ee,g as N,f as ee,d as G,B as Z,N as Se,O as ye,v as te,w as we}from"../chunks/index.02a5a54f.js";function Ce(a){let s,r,t,e,n,i,g,S,m=a[0]==="user"?"Me":"Bot",o,L,k,x,E,T;return{c(){s=y("div"),r=y("div"),t=y("div"),e=y("img"),g=P(),S=y("div"),o=q(m),L=P(),k=y("div"),x=q(a[1]),this.h()},l(f){s=w(f,"DIV",{class:!0});var v=I(s);r=w(v,"DIV",{class:!0});var O=I(r);t=w(O,"DIV",{class:!0});var D=I(t);e=w(D,"IMG",{src:!0,alt:!0}),D.forEach(C),O.forEach(C),g=V(v),S=w(v,"DIV",{class:!0});var B=I(S);o=F(B,m),B.forEach(C),L=V(v),k=w(v,"DIV",{class:!0});var R=I(k);x=F(R,a[1]),R.forEach(C),v.forEach(C),this.h()},h(){ae(e.src,n="https://ui-avatars.com/api/?name="+(a[0]==="user"?"Me":"B"))||p(e,"src",n),p(e,"alt",i=a[0]+" avatar"),p(t,"class","w-10 rounded-full"),p(r,"class","chat-image avatar"),p(S,"class","chat-header"),p(k,"class",E="chat-bubble "+(a[0]==="user"?"chat-bubble-primary":"chat-bubble-secondary")),p(s,"class",T="chat "+(a[0]==="user"?"chat-end":"chat-start")+" justify-end")},m(f,v){ge(f,s,v),h(s,r),h(r,t),h(t,e),h(s,g),h(s,S),h(S,o),h(s,L),h(s,k),h(k,x)},p(f,[v]){v&1&&!ae(e.src,n="https://ui-avatars.com/api/?name="+(f[0]==="user"?"Me":"B"))&&p(e,"src",n),v&1&&i!==(i=f[0]+" avatar")&&p(e,"alt",i),v&1&&m!==(m=f[0]==="user"?"Me":"Bot")&&ie(o,m),v&2&&ie(x,f[1]),v&1&&E!==(E="chat-bubble "+(f[0]==="user"?"chat-bubble-primary":"chat-bubble-secondary"))&&p(k,"class",E),v&1&&T!==(T="chat "+(f[0]==="user"?"chat-end":"chat-start")+" justify-end")&&p(s,"class",T)},i:le,o:le,d(f){f&&C(s)}}}function Ie(a,s,r){let{type:t}=s,{message:e}=s;return a.$$set=n=>{"type"in n&&r(0,t=n.type),"message"in n&&r(1,e=n.message)},[t,e]}class z extends me{constructor(s){super(),ve(this,s,Ie,Ce,pe,{type:0,message:1})}}var _e={};(function(a){var s=function(r,t){if(!(this instanceof s))return new s(r,t);this.INITIALIZING=-1,this.CONNECTING=0,this.OPEN=1,this.CLOSED=2,this.url=r,t=t||{},this.headers=t.headers||{},this.payload=t.payload!==void 0?t.payload:"",this.method=t.method||this.payload&&"POST"||"GET",this.withCredentials=!!t.withCredentials,this.FIELD_SEPARATOR=":",this.listeners={},this.xhr=null,this.readyState=this.INITIALIZING,this.progress=0,this.chunk="",this.addEventListener=function(e,n){this.listeners[e]===void 0&&(this.listeners[e]=[]),this.listeners[e].indexOf(n)===-1&&this.listeners[e].push(n)},this.removeEventListener=function(e,n){if(this.listeners[e]!==void 0){var i=[];this.listeners[e].forEach(function(g){g!==n&&i.push(g)}),i.length===0?delete this.listeners[e]:this.listeners[e]=i}},this.dispatchEvent=function(e){if(!e)return!0;e.source=this;var n="on"+e.type;return this.hasOwnProperty(n)&&(this[n].call(this,e),e.defaultPrevented)?!1:this.listeners[e.type]?this.listeners[e.type].every(function(i){return i(e),!e.defaultPrevented}):!0},this._setReadyState=function(e){var n=new CustomEvent("readystatechange");n.readyState=e,this.readyState=e,this.dispatchEvent(n)},this._onStreamFailure=function(e){var n=new CustomEvent("error");n.data=e.currentTarget.response,this.dispatchEvent(n),this.close()},this._onStreamAbort=function(e){this.dispatchEvent(new CustomEvent("abort")),this.close()},this._onStreamProgress=function(e){if(this.xhr){if(this.xhr.status!==200){this._onStreamFailure(e);return}this.readyState==this.CONNECTING&&(this.dispatchEvent(new CustomEvent("open")),this._setReadyState(this.OPEN));var n=this.xhr.responseText.substring(this.progress);this.progress+=n.length,n.split(/(\r\n|\r|\n){2}/g).forEach(function(i){i.trim().length===0?(this.dispatchEvent(this._parseEventChunk(this.chunk.trim())),this.chunk=""):this.chunk+=i}.bind(this))}},this._onStreamLoaded=function(e){this._onStreamProgress(e),this.dispatchEvent(this._parseEventChunk(this.chunk)),this.chunk=""},this._parseEventChunk=function(e){if(!e||e.length===0)return null;var n={id:null,retry:null,data:"",event:"message"};e.split(/\n|\r\n|\r/).forEach(function(g){g=g.trimRight();var S=g.indexOf(this.FIELD_SEPARATOR);if(!(S<=0)){var m=g.substring(0,S);if(m in n){var o=g.substring(S+1).trimLeft();m==="data"?n[m]+=o:n[m]=o}}}.bind(this));var i=new CustomEvent(n.event);return i.data=n.data,i.id=n.id,i},this._checkStreamClosed=function(){this.xhr&&this.xhr.readyState===XMLHttpRequest.DONE&&this._setReadyState(this.CLOSED)},this.stream=function(){this._setReadyState(this.CONNECTING),this.xhr=new XMLHttpRequest,this.xhr.addEventListener("progress",this._onStreamProgress.bind(this)),this.xhr.addEventListener("load",this._onStreamLoaded.bind(this)),this.xhr.addEventListener("readystatechange",this._checkStreamClosed.bind(this)),this.xhr.addEventListener("error",this._onStreamFailure.bind(this)),this.xhr.addEventListener("abort",this._onStreamAbort.bind(this)),this.xhr.open(this.method,this.url);for(var e in this.headers)this.xhr.setRequestHeader(e,this.headers[e]);this.xhr.withCredentials=this.withCredentials,this.xhr.send(this.payload)},this.close=function(){this.readyState!==this.CLOSED&&(this.xhr.abort(),this.xhr=null,this._setReadyState(this.CLOSED))}};a.SSE=s})(_e);function ce(a,s,r){const t=a.slice();return t[11]=s[r],t}function ue(a){let s,r;return s=new z({props:{type:a[11].role,message:a[11].content}}),{c(){J(s.$$.fragment)},l(t){U(s.$$.fragment,t)},m(t,e){X(s,t,e),r=!0},p(t,e){const n={};e&8&&(n.type=t[11].role),e&8&&(n.message=t[11].content),s.$set(n)},i(t){r||(N(s.$$.fragment,t),r=!0)},o(t){G(s.$$.fragment,t),r=!1},d(t){Z(s,t)}}}function fe(a){let s,r;return s=new z({props:{type:"assistant",message:a[1]}}),{c(){J(s.$$.fragment)},l(t){U(s.$$.fragment,t)},m(t,e){X(s,t,e),r=!0},p(t,e){const n={};e&2&&(n.message=t[1]),s.$set(n)},i(t){r||(N(s.$$.fragment,t),r=!0)},o(t){G(s.$$.fragment,t),r=!1},d(t){Z(s,t)}}}function de(a){let s,r;return s=new z({props:{type:"assistant",message:"Loading.."}}),{c(){J(s.$$.fragment)},l(t){U(s.$$.fragment,t)},m(t,e){X(s,t,e),r=!0},i(t){r||(N(s.$$.fragment,t),r=!0)},o(t){G(s.$$.fragment,t),r=!1},d(t){Z(s,t)}}}function Le(a){let s,r,t,e,n,i,g,S,m,o,L,k,x,E,T,f,v,O,D,B,R,K,H,Q,se;L=new z({props:{type:"assistant",message:"Welcome to Vehicle Genius! Thanks for completing the onboarding. We are in the process of creating your Genius Report now. In the meantime, access the Genius chatbot below."}});let A=a[3],u=[];for(let l=0;l<A.length;l+=1)u[l]=ue(ce(a,A,l));const be=l=>G(u[l],1,1,()=>{u[l]=null});let _=a[1]&&fe(a),b=a[2]&&de();return{c(){s=y("div"),r=y("div"),t=y("h1"),e=q("Vehicle Genius Chatbot"),n=P(),i=y("p"),g=q("Work in progress"),S=P(),m=y("div"),o=y("div"),J(L.$$.fragment),k=P();for(let l=0;l<u.length;l+=1)u[l].c();x=P(),_&&_.c(),E=P(),b&&b.c(),T=P(),f=y("div"),v=P(),O=y("form"),D=y("input"),B=P(),R=y("button"),K=q("Send"),this.h()},l(l){s=w(l,"DIV",{class:!0});var d=I(s);r=w(d,"DIV",{});var c=I(r);t=w(c,"H1",{class:!0});var $=I(t);e=F($,"Vehicle Genius Chatbot"),$.forEach(C),n=V(c),i=w(c,"P",{class:!0});var re=I(i);g=F(re,"Work in progress"),re.forEach(C),c.forEach(C),S=V(d),m=w(d,"DIV",{class:!0});var W=I(m);o=w(W,"DIV",{class:!0});var M=I(o);U(L.$$.fragment,M),k=V(M);for(let Y=0;Y<u.length;Y+=1)u[Y].l(M);x=V(M),_&&_.l(M),E=V(M),b&&b.l(M),M.forEach(C),T=V(W),f=w(W,"DIV",{class:!0}),I(f).forEach(C),W.forEach(C),v=V(d),O=w(d,"FORM",{class:!0});var j=I(O);D=w(j,"INPUT",{type:!0,class:!0}),B=V(j),R=w(j,"BUTTON",{type:!0,class:!0});var ne=I(R);K=F(ne,"Send"),ne.forEach(C),j.forEach(C),d.forEach(C),this.h()},h(){p(t,"class","text-2xl font-bold w-full text-center"),p(i,"class","text-sm italic"),p(o,"class","flex flex-col gap-2"),p(f,"class",""),p(m,"class","h-[500px] w-full bg-gray-900 rounded-md p-4 overflow-y-auto flex flex-col gap-4"),p(D,"type","text"),p(D,"class","input input-bordered w-full"),p(R,"type","submit"),p(R,"class","btn btn-accent"),p(O,"class","flex w-full rounded-md gap-4 bg-gray-900 p-4"),p(s,"class","flex flex-col pt-4 w-full px-8 items-center gap-2")},m(l,d){ge(l,s,d),h(s,r),h(r,t),h(t,e),h(r,n),h(r,i),h(i,g),h(s,S),h(s,m),h(m,o),X(L,o,null),h(o,k);for(let c=0;c<u.length;c+=1)u[c]&&u[c].m(o,null);h(o,x),_&&_.m(o,null),h(o,E),b&&b.m(o,null),h(m,T),h(m,f),a[6](f),h(s,v),h(s,O),h(O,D),he(D,a[0]),h(O,B),h(O,R),h(R,K),H=!0,Q||(se=[oe(D,"input",a[7]),oe(O,"submit",Ee(a[8]))],Q=!0)},p(l,[d]){if(d&8){A=l[3];let c;for(c=0;c<A.length;c+=1){const $=ce(l,A,c);u[c]?(u[c].p($,d),N(u[c],1)):(u[c]=ue($),u[c].c(),N(u[c],1),u[c].m(o,x))}for(te(),c=A.length;c<u.length;c+=1)be(c);ee()}l[1]?_?(_.p(l,d),d&2&&N(_,1)):(_=fe(l),_.c(),N(_,1),_.m(o,E)):_&&(te(),G(_,1,1,()=>{_=null}),ee()),l[2]?b?d&4&&N(b,1):(b=de(),b.c(),N(b,1),b.m(o,null)):b&&(te(),G(b,1,1,()=>{b=null}),ee()),d&1&&D.value!==l[0]&&he(D,l[0])},i(l){if(!H){N(L.$$.fragment,l);for(let d=0;d<A.length;d+=1)N(u[d]);N(_),N(b),H=!0}},o(l){G(L.$$.fragment,l),u=u.filter(Boolean);for(let d=0;d<u.length;d+=1)G(u[d]);G(_),G(b),H=!1},d(l){l&&C(s),Z(L),Se(u,l),_&&_.d(),b&&b.d(),a[6](null),Q=!1,ye(se)}}}function ke(a,s,r){let t="",e="",n=!1,i=[],g;function S(){setTimeout(function(){g.scrollIntoView({behavior:"smooth",block:"end",inline:"nearest"})},100)}const m=async()=>{r(2,n=!0),r(3,i=[...i,{role:"user",content:t}]);const E=new _e.SSE("/api/chat",{headers:{"Content-Type":"application/json"},payload:JSON.stringify({messages:i})});r(0,t=""),E.addEventListener("error",o),E.addEventListener("message",T=>{S();try{if(r(2,n=!1),T.data==="[DONE]"){r(3,i=[...i,{role:"assistant",content:e}]),r(1,e="");return}const f=JSON.parse(T.data),[{delta:v}]=f.choices;v.content&&r(1,e=(e??"")+v.content)}catch(f){o(f)}}),E.stream(),S()};function o(E){r(2,n=!1),r(0,t=""),r(1,e=""),console.error(E)}function L(E){we[E?"unshift":"push"](()=>{g=E,r(4,g)})}function k(){t=this.value,r(0,t)}return[t,e,n,i,g,m,L,k,()=>m()]}class Oe extends me{constructor(s){super(),ve(this,s,ke,Le,pe,{})}}export{Oe as component};
